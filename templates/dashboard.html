<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JIRAæ•ˆç‡åˆ†æç³»ç»Ÿ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            text-align: center;
        }
        
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* æ•ˆç‡åˆ†æåŒºåŸŸæ ·å¼ */
        .efficiency-analysis-section {
            margin: 40px 0;
        }
        
        .efficiency-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .efficiency-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .analysis-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .analysis-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .formula-container .formula {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .effectiveness-summary {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .analysis-metric .label {
            font-weight: bold;
            color: #333;
        }
        
        .analysis-metric .value {
            color: #667eea;
            font-weight: bold;
        }
        
        /* JIRAè¿æ¥åŒºåŸŸæ ·å¼ */
        .jira-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            margin-bottom: 40px;
        }
        
        .jira-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .jira-header h2 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .jira-connection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .connection-form, .project-selector {
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.8rem;
        }
        
        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .efficiency-header h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š JIRAæ•ˆç‡åˆ†æç³»ç»Ÿ</h1>
            <p>AIæ™ºèƒ½åˆ†å• vs äººå·¥åˆ†å•æ•ˆç‡å¯¹æ¯”åˆ†æ</p>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">{{ metrics.total_tickets }}</div>
                <div class="metric-label">æ€»å·¥å•æ•°</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.ai_tickets }}</div>
                <div class="metric-label">AIåˆ†å•</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.manual_tickets }}</div>
                <div class="metric-label">äººå·¥åˆ†å•</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.completion_rate }}%</div>
                <div class="metric-label">å®Œæˆç‡</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.avg_ai_processing_time }}</div>
                <div class="metric-label">AIå¹³å‡å¤„ç†æ—¶é—´(åˆ†é’Ÿ)</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.avg_manual_processing_time }}</div>
                <div class="metric-label">äººå·¥å¹³å‡å¤„ç†æ—¶é—´(åˆ†é’Ÿ)</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.efficiency_improvement }}%</div>
                <div class="metric-label">æ•ˆç‡æå‡</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.time_saved_total_hours }}</div>
                <div class="metric-label">èŠ‚çœæ€»æ—¶é—´(å°æ—¶)</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.ai_speed_ratio }}x</div>
                <div class="metric-label">AIå¤„ç†é€Ÿåº¦å€æ•°</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value">{{ metrics.cost_efficiency_percent }}%</div>
                <div class="metric-label">æˆæœ¬æ•ˆç›Šæå‡</div>
            </div>
        </div>
        
        <div class="charts-section">
            <div class="chart-container">
                <div id="comparisonChart"></div>
            </div>
            
            <div class="chart-container">
                <div id="workloadChart"></div>
            </div>
        </div>
        
        <!-- æ•ˆç‡å¯¹æ¯”åˆ†æåŒºåŸŸ -->
        <div class="efficiency-analysis-section">
            <div class="efficiency-header">
                <h2>ğŸš€ AIæ™ºèƒ½åˆ†å•æ•ˆæœéªŒè¯</h2>
                <p>æ•°æ®é©±åŠ¨çš„ç³»ç»Ÿæœ‰æ•ˆæ€§è¯æ˜</p>
            </div>
            
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h3>â±ï¸ æ—¶é—´æ•ˆç‡åˆ†æ</h3>
                    <div id="timeAnalysis"></div>
                </div>
                
                <div class="analysis-card">
                    <h3>ğŸ“ˆ ç”Ÿäº§åŠ›æå‡æŒ‡æ ‡</h3>
                    <div id="productivityMetrics"></div>
                </div>
                
                <div class="analysis-card">
                    <h3>ğŸ’° æŠ•èµ„å›æŠ¥ç‡(ROI)</h3>
                    <div id="roiCalculation"></div>
                </div>
                
                <div class="analysis-card">
                    <h3>ğŸ¯ æ ¸å¿ƒæ•ˆç›Šå…¬å¼</h3>
                    <div class="formula-container">
                        <p><strong>æ•ˆç‡æå‡å…¬å¼:</strong></p>
                        <div class="formula">æ•ˆç‡æå‡% = (äººå·¥å¹³å‡æ—¶é—´ - AIå¹³å‡æ—¶é—´) / äººå·¥å¹³å‡æ—¶é—´ Ã— 100%</div>
                        
                        <p><strong>æ—¶é—´èŠ‚çœå…¬å¼:</strong></p>
                        <div class="formula">æ€»èŠ‚çœæ—¶é—´ = AIå¤„ç†å·¥å•æ•° Ã— (äººå·¥å¹³å‡æ—¶é—´ - AIå¹³å‡æ—¶é—´)</div>
                        
                        <p><strong>ç”Ÿäº§åŠ›å€æ•°:</strong></p>
                        <div class="formula">ç”Ÿäº§åŠ›å€æ•° = äººå·¥å¹³å‡æ—¶é—´ / AIå¹³å‡æ—¶é—´</div>
                        
                        <div class="effectiveness-summary" id="effectivenessSummary"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- JIRAè¿æ¥åŒºåŸŸ -->
        <div class="jira-section">
            <div class="jira-header">
                <h2>ğŸ”— JIRAç³»ç»Ÿç›´è¿</h2>
                <p>ç›´æ¥ä»JIRAç³»ç»Ÿè·å–é¡¹ç›®æ•°æ®å¹¶è¿›è¡Œæ™ºèƒ½åˆ†æ</p>
            </div>
            
            <div class="jira-connection" id="jiraConnection">
                <div class="connection-form">
                    <h3>è¿æ¥é…ç½®</h3>
                    <div class="form-group">
                        <label>JIRAæœåŠ¡å™¨åœ°å€:</label>
                        <input type="url" id="jiraServer" placeholder="https://your-domain.atlassian.net" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>ç”¨æˆ·å/é‚®ç®±:</label>
                        <input type="text" id="jiraUsername" placeholder="your-email@company.com" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>API Token:</label>
                        <input type="password" id="jiraToken" placeholder="Your JIRA API Token" class="form-input">
                        <small>åœ¨JIRAè®¾ç½®ä¸­ç”ŸæˆAPI Token</small>
                    </div>
                    <button class="btn" onclick="connectJira()">ğŸ”— è¿æ¥JIRA</button>
                </div>
                
                <div class="project-selector" id="projectSelector" style="display: none;">
                    <h3>é€‰æ‹©é¡¹ç›®</h3>
                    <select id="projectSelect" class="form-input">
                        <option value="">è¯·é€‰æ‹©é¡¹ç›®...</option>
                    </select>
                    <button class="btn" onclick="importJiraData()">ğŸ“Š å¯¼å…¥é¡¹ç›®æ•°æ®</button>
                    <button class="btn" onclick="analyzeJiraData()">ğŸ” é«˜çº§åˆ†æ</button>
                </div>
            </div>
            
            <div id="jiraStatus" class="status-message"></div>
        </div>

        <div class="upload-section">
            <h2>ğŸ“ æ‰‹åŠ¨æ•°æ®ä¸Šä¼ </h2>
            <div class="upload-area" id="uploadArea">
                <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <p style="color: #666; margin-top: 10px;">æ”¯æŒ CSV, Excel, JSON æ ¼å¼</p>
                <input type="file" id="fileInput" style="display: none;" accept=".csv,.xlsx,.json">
            </div>
            
            <button class="btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
            <button class="btn" onclick="exportReport()">å¯¼å‡ºExcelæŠ¥å‘Š</button>
            <button class="btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
            
            <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <h3>ğŸ“‹ æ•°æ®æ¨¡æ¿ä¸‹è½½</h3>
                <p style="color: #666; margin: 10px 0;">å¦‚æœæ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œå»ºè®®ä¸‹è½½æ¨¡æ¿æ–‡ä»¶ï¼ŒæŒ‰ç…§æ ¼å¼å¡«å…¥æ‚¨çš„æ•°æ®</p>
                <button class="btn" onclick="downloadTemplate('csv')">ğŸ“„ ä¸‹è½½CSVæ¨¡æ¿</button>
                <button class="btn" onclick="downloadTemplate('excel')">ğŸ“Š ä¸‹è½½Excelæ¨¡æ¿</button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
        </div>
    </div>
    
    <script>
        // åŠ è½½å›¾è¡¨
        function loadCharts() {
            // åŠ è½½å¯¹æ¯”å›¾è¡¨
            fetch('/api/charts/comparison')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('comparisonChart', JSON.parse(data));
                })
                .catch(error => console.error('Error loading comparison chart:', error));
            
            // åŠ è½½å·¥ä½œè´Ÿè½½å›¾è¡¨
            fetch('/api/charts/workload')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('workloadChart', JSON.parse(data));
                })
                .catch(error => console.error('Error loading workload chart:', error));
        }
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const statusMessage = document.getElementById('statusMessage');
        
        fileInput.addEventListener('change', handleFileUpload);
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(102, 126, 234, 0.2)';
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.background = '';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = '';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileUpload();
            }
        });
        
        function handleFileUpload() {
            const file = fileInput.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            showStatus('æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', 'info');
            
            fetch('/api/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus(data.message, 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } else {
                    showStatus(data.error, 'error');
                }
            })
            .catch(error => {
                showStatus('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        function exportReport() {
            window.location.href = '/api/export/excel';
        }
        
        function refreshData() {
            location.reload();
        }
        
        function downloadTemplate(type) {
            const url = type === 'csv' ? '/api/template/csv' : '/api/template/excel';
            const link = document.createElement('a');
            link.href = url;
            link.download = type === 'csv' ? 'jira_data_template.csv' : 'jira_data_template.xlsx';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus(`æ­£åœ¨ä¸‹è½½${type.toUpperCase()}æ¨¡æ¿æ–‡ä»¶...`, 'success');
        }
        
        // JIRAè¿æ¥åŠŸèƒ½
        function connectJira() {
            const server = document.getElementById('jiraServer').value.trim();
            const username = document.getElementById('jiraUsername').value.trim();
            const token = document.getElementById('jiraToken').value.trim();
            
            if (!server || !username || !token) {
                showJiraStatus('è¯·å¡«å†™å®Œæ•´çš„è¿æ¥ä¿¡æ¯', 'error');
                return;
            }
            
            showJiraStatus('æ­£åœ¨è¿æ¥JIRAæœåŠ¡å™¨...', 'info');
            
            fetch('/api/jira/connect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    server: server,
                    username: username,
                    token: token
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showJiraStatus(`è¿æ¥æˆåŠŸï¼æœåŠ¡å™¨: ${data.server}`, 'success');
                    loadJiraProjects();
                } else {
                    showJiraStatus(data.error, 'error');
                }
            })
            .catch(error => {
                showJiraStatus('è¿æ¥å¤±è´¥: ' + error.message, 'error');
            });
        }
        
        function loadJiraProjects() {
            fetch('/api/jira/projects')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const select = document.getElementById('projectSelect');
                        select.innerHTML = '<option value="">è¯·é€‰æ‹©é¡¹ç›®...</option>';
                        
                        data.projects.forEach(([key, name]) => {
                            const option = document.createElement('option');
                            option.value = key;
                            option.textContent = `${key} - ${name}`;
                            select.appendChild(option);
                        });
                        
                        document.getElementById('projectSelector').style.display = 'block';
                        showJiraStatus(`å‘ç° ${data.count} ä¸ªé¡¹ç›®`, 'success');
                    } else {
                        showJiraStatus(data.error, 'error');
                    }
                })
                .catch(error => {
                    showJiraStatus('è·å–é¡¹ç›®åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        function importJiraData() {
            const projectKey = document.getElementById('projectSelect').value;
            if (!projectKey) {
                showJiraStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®', 'error');
                return;
            }
            
            showJiraStatus('æ­£åœ¨å¯¼å…¥é¡¹ç›®æ•°æ®ï¼Œè¯·ç¨å€™...', 'info');
            
            fetch(`/api/jira/import/${projectKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showJiraStatus(`${data.message}`, 'success');
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    } else {
                        showJiraStatus(data.error, 'error');
                    }
                })
                .catch(error => {
                    showJiraStatus('å¯¼å…¥æ•°æ®å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        function analyzeJiraData() {
            showJiraStatus('æ­£åœ¨è¿›è¡Œé«˜çº§åˆ†æ...', 'info');
            
            fetch('/api/jira/analysis/advanced')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showJiraStatus(data.error, 'error');
                        return;
                    }
                    
                    // æ˜¾ç¤ºåˆ†æç»“æœ
                    displayAdvancedAnalysis(data);
                    showJiraStatus('é«˜çº§åˆ†æå®Œæˆï¼', 'success');
                })
                .catch(error => {
                    showJiraStatus('åˆ†æå¤±è´¥: ' + error.message, 'error');
                });
        }
        
        function displayAdvancedAnalysis(analysis) {
            // åˆ›å»ºåˆ†æç»“æœæ˜¾ç¤ºçª—å£
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;
                display: flex; align-items: center; justify-content: center; padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 15px; padding: 30px; 
                max-width: 90%; max-height: 90%; overflow-y: auto;
            `;
            
            content.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #667eea;">ğŸ” JIRAé¡¹ç›®é«˜çº§åˆ†ææŠ¥å‘Š</h2>
                    <button onclick="this.closest('[style*=fixed]').remove()" style="
                        background: #f44336; color: white; border: none; 
                        padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: auto;
                    ">å…³é—­</button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                        <h3>ğŸ“Š é¡¹ç›®å¥åº·åº¦</h3>
                        <p><strong>å¥åº·è¯„åˆ†:</strong> ${analysis.project_health?.health_score || 0}/100</p>
                        <p><strong>çŠ¶æ€:</strong> ${analysis.project_health?.health_status || 'æœªçŸ¥'}</p>
                        <p><strong>è§£å†³ç‡:</strong> ${analysis.project_health?.resolution_rate || 0}%</p>
                        <p><strong>å¹³å‡è§£å†³æ—¶é—´:</strong> ${analysis.project_health?.avg_resolution_days || 0} å¤©</p>
                    </div>
                    
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                        <h3>ğŸ‘¥ å›¢é˜Ÿç»©æ•ˆ</h3>
                        <p><strong>å›¢é˜Ÿè§„æ¨¡:</strong> ${analysis.team_performance?.team_size || 0} äºº</p>
                        <p><strong>æœ€ä½³è¡¨ç°:</strong> ${analysis.team_performance?.top_performer || 'æœªçŸ¥'}</p>
                        <p><strong>æœ€é«˜äº§å‡º:</strong> ${analysis.team_performance?.most_productive || 'æœªçŸ¥'}</p>
                    </div>
                    
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                        <h3>âš¡ è´¨é‡æŒ‡æ ‡</h3>
                        <p><strong>è´¨é‡è¯„åˆ†:</strong> ${analysis.quality_metrics?.quality_score || 0}/100</p>
                        <p><strong>é«˜ä¼˜å…ˆçº§æ¯”ä¾‹:</strong> ${analysis.quality_metrics?.high_priority_rate || 0}%</p>
                        <p><strong>æœªåˆ†é…æ¯”ä¾‹:</strong> ${analysis.quality_metrics?.unassigned_rate || 0}%</p>
                        <p><strong>è¶…æœŸæ¯”ä¾‹:</strong> ${analysis.quality_metrics?.overdue_rate || 0}%</p>
                    </div>
                    
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                        <h3>ğŸ“ˆ èµ„æºåˆ©ç”¨</h3>
                        <p><strong>èµ„æºåˆ©ç”¨ç‡:</strong> ${analysis.resource_allocation?.resource_utilization || 0}%</p>
                        <p><strong>è´Ÿè½½å¹³è¡¡åº¦:</strong> ${analysis.resource_allocation?.workload_balance_score || 0}/100</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>ğŸ’¡ å…³é”®æ´å¯Ÿå’Œå»ºè®®</h3>
                    ${analysis.insights_and_recommendations?.map(insight => `
                        <div style="background: ${insight.level === 'alert' ? '#ffebee' : '#fff3e0'}; 
                                    padding: 10px; border-radius: 5px; margin: 10px 0; 
                                    border-left: 4px solid ${insight.level === 'alert' ? '#f44336' : '#ff9800'};">
                            <strong>${insight.message}</strong><br>
                            <small>å»ºè®®: ${insight.recommendation}</small>
                        </div>
                    `).join('') || '<p>æš‚æ— ç‰¹æ®Šæ´å¯Ÿ</p>'}
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        function showJiraStatus(message, type) {
            const statusElement = document.getElementById('jiraStatus');
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        }
        
        // åŠ è½½æ•ˆç‡åˆ†ææ•°æ®
        function loadEfficiencyAnalysis() {
            fetch('/api/efficiency/analysis')
                .then(response => response.json())
                .then(data => {
                    // å¡«å……æ—¶é—´æ•ˆç‡åˆ†æ
                    const timeAnalysis = document.getElementById('timeAnalysis');
                    timeAnalysis.innerHTML = `
                        <div class="analysis-metric">
                            <span class="label">AIå¹³å‡å¤„ç†æ—¶é—´:</span>
                            <span class="value">${data.time_analysis.ai_avg_time} åˆ†é’Ÿ</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">äººå·¥å¹³å‡å¤„ç†æ—¶é—´:</span>
                            <span class="value">${data.time_analysis.manual_avg_time} åˆ†é’Ÿ</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">æ¯å¼ å·¥å•èŠ‚çœæ—¶é—´:</span>
                            <span class="value">${data.time_analysis.time_saved_per_ticket} åˆ†é’Ÿ</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">æ€»è®¡èŠ‚çœæ—¶é—´:</span>
                            <span class="value">${data.time_analysis.total_time_saved_hours} å°æ—¶</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">AIå¤„ç†é€Ÿåº¦ä¼˜åŠ¿:</span>
                            <span class="value">${data.time_analysis.ai_speed_advantage}</span>
                        </div>
                    `;
                    
                    // å¡«å……ç”Ÿäº§åŠ›æŒ‡æ ‡
                    const productivityMetrics = document.getElementById('productivityMetrics');
                    productivityMetrics.innerHTML = `
                        <div class="analysis-metric">
                            <span class="label">ç”Ÿäº§åŠ›æå‡å€æ•°:</span>
                            <span class="value">${data.productivity_metrics.productivity_gain_ratio}x</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">æˆæœ¬æ•ˆç›Šæå‡:</span>
                            <span class="value">${data.productivity_metrics.cost_efficiency}%</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">å·¥å•å®Œæˆç‡:</span>
                            <span class="value">${data.productivity_metrics.completion_rate}%</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">AI vs äººå·¥æ¯”ä¾‹:</span>
                            <span class="value">${data.summary.ai_vs_manual_ratio}</span>
                        </div>
                    `;
                    
                    // å¡«å……ROIè®¡ç®—
                    const roiCalculation = document.getElementById('roiCalculation');
                    roiCalculation.innerHTML = `
                        <div class="analysis-metric">
                            <span class="label">æ•ˆç‡è¯„åˆ†:</span>
                            <span class="value">${data.roi_calculation.efficiency_score}/100</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="label">é¢„ä¼°æœˆèŠ‚çœæˆæœ¬:</span>
                            <span class="value">Â¥${data.roi_calculation.estimated_monthly_savings}</span>
                        </div>
                        <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                            <strong>è®¡ç®—è¯´æ˜:</strong> ${data.roi_calculation.description}
                        </p>
                        <p style="color: #666; font-size: 0.8rem; margin-top: 10px;">
                            <strong>å…¬å¼:</strong> ${data.roi_calculation.formula}
                        </p>
                    `;
                    
                    // å¡«å……æœ‰æ•ˆæ€§æ€»ç»“
                    const effectivenessSummary = document.getElementById('effectivenessSummary');
                    const improvement = data.summary.overall_efficiency_improvement;
                    let conclusion = '';
                    if (improvement > 50) {
                        conclusion = 'ğŸ‰ ç³»ç»Ÿè¡¨ç°å“è¶Šï¼AIåˆ†å•æ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡';
                    } else if (improvement > 20) {
                        conclusion = 'ğŸ‘ ç³»ç»Ÿè¡¨ç°è‰¯å¥½ï¼AIåˆ†å•æ˜æ˜¾ä¼˜äºäººå·¥åˆ†å•';
                    } else if (improvement > 0) {
                        conclusion = 'âœ… ç³»ç»Ÿæœ‰æ•ˆï¼AIåˆ†å•ç•¥ä¼˜äºäººå·¥åˆ†å•';
                    } else {
                        conclusion = 'âš ï¸ éœ€è¦ä¼˜åŒ–ï¼å»ºè®®æ£€æŸ¥AIåˆ†å•ç­–ç•¥';
                    }
                    
                    effectivenessSummary.innerHTML = `
                        <h4>ğŸ“Š ç³»ç»Ÿæœ‰æ•ˆæ€§éªŒè¯ç»“æœ</h4>
                        <p><strong>æ•´ä½“æ•ˆç‡æå‡:</strong> ${improvement}%</p>
                        <p><strong>ç»“è®º:</strong> ${conclusion}</p>
                        <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                            åŸºäº ${data.summary.total_tickets} å¼ å·¥å•çš„æ•°æ®åˆ†æï¼ŒAIæ™ºèƒ½åˆ†å•ç³»ç»Ÿç›¸æ¯”ä¼ ç»Ÿäººå·¥åˆ†å•åœ¨å¤„ç†æ•ˆç‡ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚
                        </p>
                    `;
                })
                .catch(error => console.error('Error loading efficiency analysis:', error));
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å›¾è¡¨å’Œåˆ†ææ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadCharts();
            loadEfficiencyAnalysis();
        });
    </script>
</body>
</html>